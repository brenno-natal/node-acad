<!DOCTYPE html>
<html lang="en">

<head>

    <%- include('header') %>

    <%- defineContent('header-end') %>

    <link rel="stylesheet" href="/css/responsive.css">

</head>

<body onload="setIcon()">
    <div class="container-fluid">

        <%- body %>

    </div>


    <%- include('footer') %>

    <script src="/js/home-page.js"></script>

    <script>


        $("#form").validate({
            rules: {
                name: {
                    required: false,
                    maxlength: 50
                },
                type: {
                    required: false,
                    maxlength: 50
                },
                amount: {
                    required: false
                }
            },

            submitHandler: function (form) {

                if ($.active) return

                let name = $("#name")
                let type = $("#type")
                let amount = $("#amount")

                name = name.val()
                type = type.val()
                amount = parseFloat(amount.val())

                var transaction = {
                    name: name,
                    type: type,
                    value: amount
                }

                $.ajax({
                    url: "/api/conta/create",
                    method: "post",
                    data: JSON.stringify(transaction),

                    processData: false,
                    contentType: "application/json",

                    success: function (dadosDeRetorno) {
                        alert(dadosDeRetorno)
                        form.reset()
                        setTimeout(() => { window.location = "/" }, 1)
                    },

                    error: function (xhr) {
                        try {
                            alert(JSON.parse(xhr.responseText));
                        } catch (err) {
                            alert("Something went wrong");
                        }
                    }
                })
            }
        })
    </script>

</body>

</html>